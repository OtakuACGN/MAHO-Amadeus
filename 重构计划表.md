首先，目前短期目标是，可以实现屏幕上有两个或多个角色。然后我可以直接说话然后就问他们这时候会有一个类似意图识别的东西来决定这一句话会发给他们还是发给全部人。同时角色也可以互相对话。

思考：
- 最终要想要实现向命运石之门那样子的演出效果。所以假如有多个角色想要回答的话，那么就必须以存在一个队列机制。具体来说就是目前的对话框。算是已经解耦好了，这个对话框的话，一个时刻它只能存在一段话。
- 那么当我说完一句话之后，前端还是直接照样发给后端，这时候后端要有一个意图识别，暂时决定由导演来承担这个角色，所以原本是直接由前端决定发给谁的，这个得改了。
- 导演收到消息之后，首先先将这一轮对话存到剧本里面。剧本里面存在一个公共上下文窗口，然后再根据意图识别的结果，决定把这一句话发给谁。同时这个剧本还存在世界观之类的信息。
- 那么后端的组件得先添加一个意图识别专用的，虽然实际上还是一个LLM。
- 因为刚才说的现在有多个角色轮流对话了，所以得考虑一下。当角色说完之后，点击一下才会开始输入下一个角色的内容，那么对话框可能还需要再进行一个结合。意思就是用户输入和角色返回信息的解耦开。
- 关于整一个vad，也就是用户说话的内容。这一部分实际上很简单，因为它就只是相当于一个自动检测的语音输入而已，只需要在最外层也就是说话的这个地方。把语音转成文字，然后再塞进去，触发标准流程就行了。
- 角色，自己也拥有自己的独立上下文，这个部分的，

问答流程：
- 用户说话，vad检测到用户说话完毕，直接发送音频切片
- 后端asr组件收到音频切片，进行语音识别，得到用户的这一句话，并将其发送给后端的导演组件
- 后端的导演组件收到这一句话，首先将其存到剧本的公共上下文窗口里面，然后进行意图识别，决定将这一句话发给哪个角色
- 后端的导演组件将用户的这一句话发送给指定的角色组件（或者多个角色组件）
- 角色组件收到用户的这一句话，结合自己的独立上下文进行处理，生成回答并发送给后端的导演组件
- 导演接收到角色的回答，先将其存到剧本，然后再发给前端。
- 前端收到角色的回答和TTS，先将其存到一个播放列表中。
- 前端从播放列表中依次取出回答和TTS进行播放和显示，每次播放完之后，先暂时不要马上切换。当用户在播放完的状态下，点击鼠标才会进行下一个状态的播放。
- 当播放完所有角色的回答之后，前端重新进入等待用户说话的状态。

不太可能会改的：
- 后端的llm,asr,translator组件
- 前端的login，

Character：
- 角色组件应当有一个函数。这个函数接受一个字符串触发之后就会直接。在角色内部。通过这个问题给出一个回答。
- 现在的话，这个。聊天函数，还有。输出，这些都做得比较自洽了，基本上形成了一个比较好的模块。
- 但是输出这一部分还没想好。到底是应该怎么做？目标肯定是要交给导演的，然后导演应该会有一个队列，里面只有最上层才会交给前端处理。

思考：
- 角色组建基本完成。最后的成果是一个类实例化之后。根据配置和TTS。然后可以用一个函数传递问题，然后会自动在其中的一个队列里面生成。很多条数据，这些数据开头一定是一个star类型的一段数据。结尾一定是一个拥有结尾标签的数据，中间是文本和深度思考，还有音频混合的一些内容。
- 如果把刚才的一整个队列看做一个包的话，那么可以考虑解耦一个传递机制，针对于一个包就算做一次传递。但是因为前端是流式输出的。所以这个包。实现起来可能比较复杂。
- 现在来看的话还差角色TTS多模型加载支持，剧本和导演到底该怎么做？然后还有中间通信机制就差不多了。
- 前端的话，每一个包就对应前端一次台词效果我觉得不错。
- 对了，让前端单纯地成为一个播放的角色，后端才是掌管复杂逻辑的。具体来说。前端，它只会像现在接受一次包，那么就相当于是一次播放演出，一次播放演出就相当。当于屏幕上会有角色台词逐行出现，然后角色语音逐行播放，后面的角色立绘可能还会有动作。

前端：
- 现在先构建前端，前端应该成为一个纯演出效果的处理渲染器。所有的状态都有store存储。然后现在每一个前端的Vue组件都要做好一件事，就是响应式，真正的成为只渲染的一个东西。

思考：
- 总之，现在最重要的是。先把这个。每一个角色的输出，这种舞台效果。也就是上面的那一个一轮对话，先搞好那一些TTS之类的，先暂时不管。


流程：
- 用户说话，vad检测到用户说话完毕，直接发送音频切片
- 后端asr组件收到音频切片，进行语音识别，得到用户的这一句话，并将其发送给后端的导演组件
- 后端的导演组件收到这一句话，首先将其存到剧本的公共上下文窗口里面，然后进行意图识别，决定将这一句话发给哪个角色
- 后端的导演组件将用户的这一句话发送给指定的角色组件（或者多个角色组件），同时在台词本上记录下来哪些角色要说话
- 角色组件收到用户的这一句话，结合自己的独立上下文进行处理，生成回答在自己的列表内
- 导演时刻检查台词本上的角色，依次从角色组件的回答列表中取出回答，发送给前端。
- 发送完成这一一个角色的输出之后，先进入等待状态。
- 前端收到角色的回答，还有地铁S直接将其放在对话框和播放。也就是直接进行演出。
- 前端播放完之后，等待用户点击“下一步”，如果点击了，就向后端发送信息。
- 同时前端自己进入的用户输入状态，这个过程不用慌，如果后端还有要输入的内容，会自己。发送信息，让前端再一次进入角色说话状态。


思考：
- 已经重构了很多地方，最重要的收获就是。还是要节后封装，这一点是永恒不变的。然后的话就是自己要有一个大局观，直到全局应该是什么样的流程。然后要对这个全局能够解耦开来，知道里面的逻辑，再针对于。这里面的逻辑就重新设计是注意是重新设计，而不是更改原有的内容。
- 所以不用担心自己删掉了以前珍贵的逻辑。那些都是旧的虽然可能也有精华，但是已经过时了。重新设计才是王道。